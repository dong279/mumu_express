<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인/회원가입 테스트</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .section { margin-bottom: 40px; padding: 20px; border: 1px solid #ccc; }
        input, button { display: block; margin: 10px 0; padding: 8px; width: 300px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>MUMU 로그인/회원가입 테스트</h1>

    <!-- 회원가입 -->
    <div class="section">
        <h2>회원가입</h2>
        <input type="text" id="reg-id" placeholder="아이디 (3~50자)">
        <input type="password" id="reg-password" placeholder="비밀번호 (8자 이상)">
        <input type="text" id="reg-name" placeholder="이름">
        <input type="text" id="reg-phone" placeholder="전화번호 (선택)">
        <input type="text" id="reg-address" placeholder="주소 (선택)">
        <input type="text" id="reg-detail-address" placeholder="상세주소 (선택)">
        <input type="text" id="reg-postal-code" placeholder="우편번호 (선택)">
        
        <label><input type="checkbox" id="reg-terms"> 서비스 이용약관 동의 (필수)</label>
        <label><input type="checkbox" id="reg-privacy"> 개인정보처리방침 동의 (필수)</label>
        <label><input type="checkbox" id="reg-marketing"> 마케팅 수신 동의 (선택)</label>
        
        <button onclick="register()">회원가입</button>
        <div id="reg-result" class="result"></div>
    </div>

    <!-- 로그인 -->
    <div class="section">
        <h2>로그인</h2>
        <input type="text" id="login-id" placeholder="아이디">
        <input type="password" id="login-password" placeholder="비밀번호">
        <button onclick="login()">로그인</button>
        <div id="login-result" class="result"></div>
    </div>

    <!-- 프로필 조회 -->
    <div class="section">
        <h2>프로필 조회 (로그인 필요)</h2>
        <button onclick="getProfile()">프로필 조회</button>
        <div id="profile-result" class="result"></div>
    </div>

    <script>
        const API = 'http://localhost:3000/api';

        // 회원가입
        async function register() {
            const data = {
                id: document.getElementById('reg-id').value,
                password: document.getElementById('reg-password').value,
                name: document.getElementById('reg-name').value,
                phone: document.getElementById('reg-phone').value || undefined,
                address: document.getElementById('reg-address').value || undefined,
                detail_address: document.getElementById('reg-detail-address').value || undefined,
                postal_code: document.getElementById('reg-postal-code').value || undefined,
                terms_agreed: document.getElementById('reg-terms').checked,
                privacy_agreed: document.getElementById('reg-privacy').checked,
                marketing_agreed: document.getElementById('reg-marketing').checked
            };

            try {
                const res = await fetch(`${API}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                
                const resultDiv = document.getElementById('reg-result');
                if (result.success) {
                    localStorage.setItem('token', result.token);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ ${result.message}<br>토큰 저장됨<br>${JSON.stringify(result.user, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ ${result.error}`;
                }
            } catch (err) {
                document.getElementById('reg-result').innerHTML = `❌ 오류: ${err.message}`;
            }
        }

        // 로그인
        async function login() {
            const data = {
                id: document.getElementById('login-id').value,
                password: document.getElementById('login-password').value
            };

            try {
                const res = await fetch(`${API}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                
                const resultDiv = document.getElementById('login-result');
                if (result.success) {
                    localStorage.setItem('token', result.token);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ ${result.message}<br>토큰 저장됨<br>${JSON.stringify(result.user, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ ${result.error}`;
                }
            } catch (err) {
                document.getElementById('login-result').innerHTML = `❌ 오류: ${err.message}`;
            }
        }

        // 프로필 조회
        async function getProfile() {
            const token = localStorage.getItem('token');
            if (!token) {
                document.getElementById('profile-result').innerHTML = '❌ 로그인이 필요합니다';
                return;
            }

            try {
                const res = await fetch(`${API}/users/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await res.json();
                
                const resultDiv = document.getElementById('profile-result');
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ 프로필 조회 성공<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `❌ ${result.error}`;
                }
            } catch (err) {
                document.getElementById('profile-result').innerHTML = `❌ 오류: ${err.message}`;
            }
        }
    </script>
</body>
</html>